#include "game_macros_hid_map.h"

#define GAME_MACROS_HID_PAIRS_LEN sizeof(game_macros_hid_pairs) / sizeof(GameMacrosMap)


GameMacrosMap game_macros_hid_pairs[] = {
    {.key = "a", .value = HID_KEYBOARD_A},
    {.key = "b", .value = HID_KEYBOARD_B},
    {.key = "c", .value = HID_KEYBOARD_C},
    {.key = "d", .value = HID_KEYBOARD_D},
    {.key = "e", .value = HID_KEYBOARD_E},
    {.key = "f", .value = HID_KEYBOARD_F},
    {.key = "g", .value = HID_KEYBOARD_G},
    {.key = "h", .value = HID_KEYBOARD_H},
    {.key = "i", .value = HID_KEYBOARD_I},
    {.key = "j", .value = HID_KEYBOARD_J},
    {.key = "k", .value = HID_KEYBOARD_K},
    {.key = "l", .value = HID_KEYBOARD_L},
    {.key = "m", .value = HID_KEYBOARD_M},
    {.key = "n", .value = HID_KEYBOARD_N},
    {.key = "o", .value = HID_KEYBOARD_O},
    {.key = "p", .value = HID_KEYBOARD_P},
    {.key = "q", .value = HID_KEYBOARD_Q},
    {.key = "r", .value = HID_KEYBOARD_R},
    {.key = "s", .value = HID_KEYBOARD_S},
    {.key = "t", .value = HID_KEYBOARD_T},
    {.key = "u", .value = HID_KEYBOARD_U},
    {.key = "v", .value = HID_KEYBOARD_V},
    {.key = "w", .value = HID_KEYBOARD_W},
    {.key = "x", .value = HID_KEYBOARD_X},
    {.key = "y", .value = HID_KEYBOARD_Y},
    {.key = "z", .value = HID_KEYBOARD_Z},
    {.key = "1", .value = HID_KEYBOARD_1},
    {.key = "2", .value = HID_KEYBOARD_2},
    {.key = "3", .value = HID_KEYBOARD_3},
    {.key = "4", .value = HID_KEYBOARD_4},
    {.key = "5", .value = HID_KEYBOARD_5},
    {.key = "6", .value = HID_KEYBOARD_6},
    {.key = "7", .value = HID_KEYBOARD_7},
    {.key = "8", .value = HID_KEYBOARD_8},
    {.key = "9", .value = HID_KEYBOARD_9},
    {.key = "0", .value = HID_KEYBOARD_0},
    {.key = "return", .value = HID_KEYBOARD_RETURN},
    {.key = "escape", .value = HID_KEYBOARD_ESCAPE},
    {.key = "delete", .value = HID_KEYBOARD_DELETE},
    {.key = "tab", .value = HID_KEYBOARD_TAB},
    {.key = "spacebar", .value = HID_KEYBOARD_SPACEBAR},
    {.key = "minus", .value = HID_KEYBOARD_MINUS},
    {.key = "equal", .value = HID_KEYBOARD_EQUAL_SIGN},
    {.key = "open_bracket", .value = HID_KEYBOARD_OPEN_BRACKET},
    {.key = "close_bracket", .value = HID_KEYBOARD_CLOSE_BRACKET},
    {.key = "backslash", .value = HID_KEYBOARD_BACKSLASH},
    {.key = "nonus_hash", .value = HID_KEYBOARD_NONUS_HASH},
    {.key = "semicolon", .value = HID_KEYBOARD_SEMICOLON},
    {.key = "apostrophe", .value = HID_KEYBOARD_APOSTROPHE},
    {.key = "grave_accent", .value = HID_KEYBOARD_GRAVE_ACCENT},
    {.key = "comma", .value = HID_KEYBOARD_COMMA},
    {.key = "dot", .value = HID_KEYBOARD_DOT},
    {.key = "slash", .value = HID_KEYBOARD_SLASH},
    {.key = "caps_lock", .value = HID_KEYBOARD_CAPS_LOCK},
    {.key = "f1", .value = HID_KEYBOARD_F1},
    {.key = "f2", .value = HID_KEYBOARD_F2},
    {.key = "f3", .value = HID_KEYBOARD_F3},
    {.key = "f4", .value = HID_KEYBOARD_F4},
    {.key = "f5", .value = HID_KEYBOARD_F5},
    {.key = "f6", .value = HID_KEYBOARD_F6},
    {.key = "f7", .value = HID_KEYBOARD_F7},
    {.key = "f8", .value = HID_KEYBOARD_F8},
    {.key = "f9", .value = HID_KEYBOARD_F9},
    {.key = "f10", .value = HID_KEYBOARD_F10},
    {.key = "f11", .value = HID_KEYBOARD_F11},
    {.key = "f12", .value = HID_KEYBOARD_F12},
    {.key = "print_screen", .value = HID_KEYBOARD_PRINT_SCREEN},
    {.key = "scroll_lock", .value = HID_KEYBOARD_SCROLL_LOCK},
    {.key = "pause", .value = HID_KEYBOARD_PAUSE},
    {.key = "insert", .value = HID_KEYBOARD_INSERT},
    {.key = "home", .value = HID_KEYBOARD_HOME},
    {.key = "page_up", .value = HID_KEYBOARD_PAGE_UP},
    {.key = "delete_forward", .value = HID_KEYBOARD_DELETE_FORWARD},
    {.key = "end", .value = HID_KEYBOARD_END},
    {.key = "page_down", .value = HID_KEYBOARD_PAGE_DOWN},
    {.key = "right_arrow", .value = HID_KEYBOARD_RIGHT_ARROW},
    {.key = "left_arrow", .value = HID_KEYBOARD_LEFT_ARROW},
    {.key = "down_arrow", .value = HID_KEYBOARD_DOWN_ARROW},
    {.key = "up_arrow", .value = HID_KEYBOARD_UP_ARROW},
    {.key = "nonus_backslash", .value = HID_KEYBOARD_NONUS_BACKSLASH},
    {.key = "application", .value = HID_KEYBOARD_APPLICATION},
    {.key = "power", .value = HID_KEYBOARD_POWER},
    {.key = "f13", .value = HID_KEYBOARD_F13},
    {.key = "f14", .value = HID_KEYBOARD_F14},
    {.key = "f15", .value = HID_KEYBOARD_F15},
    {.key = "f16", .value = HID_KEYBOARD_F16},
    {.key = "f17", .value = HID_KEYBOARD_F17},
    {.key = "f18", .value = HID_KEYBOARD_F18},
    {.key = "f19", .value = HID_KEYBOARD_F19},
    {.key = "f20", .value = HID_KEYBOARD_F20},
    {.key = "f21", .value = HID_KEYBOARD_F21},
    {.key = "f22", .value = HID_KEYBOARD_F22},
    {.key = "f23", .value = HID_KEYBOARD_F23},
    {.key = "f24", .value = HID_KEYBOARD_F24},
    {.key = "execute", .value = HID_KEYBOARD_EXECUTE},
    {.key = "help", .value = HID_KEYBOARD_HELP},
    {.key = "menu", .value = HID_KEYBOARD_MENU},
    {.key = "select", .value = HID_KEYBOARD_SELECT},
    {.key = "stop", .value = HID_KEYBOARD_STOP},
    {.key = "again", .value = HID_KEYBOARD_AGAIN},
    {.key = "undo", .value = HID_KEYBOARD_UNDO},
    {.key = "cut", .value = HID_KEYBOARD_CUT},
    {.key = "copy", .value = HID_KEYBOARD_COPY},
    {.key = "paste", .value = HID_KEYBOARD_PASTE},
    {.key = "find", .value = HID_KEYBOARD_FIND},
    {.key = "mute", .value = HID_KEYBOARD_MUTE},
    {.key = "volume_up", .value = HID_KEYBOARD_VOLUME_UP},
    {.key = "volume_down", .value = HID_KEYBOARD_VOLUME_DOWN},
    {.key = "lock_caps_lock", .value = HID_KEYBOARD_LOCK_CAPS_LOCK},
    {.key = "lock_num_lock", .value = HID_KEYBOARD_LOCK_NUM_LOCK},
    {.key = "lock_scroll_lock", .value = HID_KEYBOARD_LOCK_SCROLL_LOCK},
    {.key = "keyboard_international_1", .value = HID_KEYBOARD_INTERNATIONAL_1},
    {.key = "keyboard_international_2", .value = HID_KEYBOARD_INTERNATIONAL_2},
    {.key = "keyboard_international_3", .value = HID_KEYBOARD_INTERNATIONAL_3},
    {.key = "keyboard_international_4", .value = HID_KEYBOARD_INTERNATIONAL_4},
    {.key = "keyboard_international_5", .value = HID_KEYBOARD_INTERNATIONAL_5},
    {.key = "keyboard_international_6", .value = HID_KEYBOARD_INTERNATIONAL_6},
    {.key = "keyboard_international_7", .value = HID_KEYBOARD_INTERNATIONAL_7},
    {.key = "keyboard_international_8", .value = HID_KEYBOARD_INTERNATIONAL_8},
    {.key = "keyboard_international_9", .value = HID_KEYBOARD_INTERNATIONAL_9},
    {.key = "keyboard_lang_1", .value = HID_KEYBOARD_LANG_1},
    {.key = "keyboard_lang_2", .value = HID_KEYBOARD_LANG_2},
    {.key = "keyboard_lang_3", .value = HID_KEYBOARD_LANG_3},
    {.key = "keyboard_lang_4", .value = HID_KEYBOARD_LANG_4},
    {.key = "keyboard_lang_5", .value = HID_KEYBOARD_LANG_5},
    {.key = "keyboard_lang_6", .value = HID_KEYBOARD_LANG_6},
    {.key = "keyboard_lang_7", .value = HID_KEYBOARD_LANG_7},
    {.key = "keyboard_lang_8", .value = HID_KEYBOARD_LANG_8},
    {.key = "keyboard_lang_9", .value = HID_KEYBOARD_LANG_9},
    {.key = "alternate_erase", .value = HID_KEYBOARD_ALTERNATE_ERASE},
    {.key = "sysreq", .value = HID_KEYBOARD_SYSREQ},
    {.key = "cancel", .value = HID_KEYBOARD_CANCEL},
    {.key = "clear", .value = HID_KEYBOARD_CLEAR},
    {.key = "prior", .value = HID_KEYBOARD_PRIOR},
    {.key = "return_1", .value = HID_KEYBOARD_RETURN_1},
    {.key = "separator", .value = HID_KEYBOARD_SEPARATOR},
    {.key = "out", .value = HID_KEYBOARD_OUT},
    {.key = "oper", .value = HID_KEYBOARD_OPER},
    {.key = "clear_again", .value = HID_KEYBOARD_CLEAR_AGAIN},
    {.key = "crsel_props", .value = HID_KEYBOARD_CRSEL_PROPS},
    {.key = "exsel", .value = HID_KEYBOARD_EXSEL},
    {.key = "l_ctrl", .value = HID_KEYBOARD_L_CTRL},
    {.key = "l_shift", .value = HID_KEYBOARD_L_SHIFT},
    {.key = "l_alt", .value = HID_KEYBOARD_L_ALT},
    {.key = "l_gui", .value = HID_KEYBOARD_L_GUI},
    {.key = "r_ctrl", .value = HID_KEYBOARD_R_CTRL},
    {.key = "r_shift", .value = HID_KEYBOARD_R_SHIFT},
    {.key = "r_alt", .value = HID_KEYBOARD_R_ALT},
    {.key = "r_gui", .value = HID_KEYBOARD_R_GUI}
};
    

bool game_macros_compare_strings(const char* str1, const char* str2) {

    while (*str1 != '\0') {
        if (*str1 == ' ' || *str1 == '\n' || *str2 == ' ' || *str2 == '\n') {
            break;
        }
        if (*str2 == '\0') {
            return false;
        }
        if (*str1 != *str2) {
            return false;
        }
        str1++;
        str2++;
    }
    if (*str2 == '\0') return true;
    return false;
}

void game_macros_get_cut_string(char** str, size_t size) {
    for (size_t i = 0; i < size; i++)
    {
        if ((*str)[i] == '\n' || (*str)[i] == ' ') {
            (*str)[i] = '\0';
        }
    }
    
}

uint16_t game_macros_get_hid_pair(const char* key) {
    FURI_LOG_I("GMS", "get hid pair");
    FuriString* strdbg = furi_string_alloc();
    for(size_t i = 0; i < GAME_MACROS_HID_PAIRS_LEN; i++) {
        GameMacrosMap pair = game_macros_hid_pairs[i];
        furi_string_printf(strdbg, "%.10s: %s", key, pair.key);
        if (game_macros_compare_strings(key, pair.key) != false) {
            furi_string_free(strdbg);
            return pair.value;
        };
    }
    furi_string_free(strdbg);
    return 0;
}
size_t game_macros_parse_number(const char* key) {
    FURI_LOG_I("GMS", "parse number");
    if (*key >= '0' && *key <= '9') {
        return game_macros_string_to_int(key);
    }
    return 0;
}

size_t game_macros_string_to_int(const char* key) {
    size_t number = 0;
    for(size_t i = 0;; i++) {
       char cur_char = key[i];
        if (cur_char >= '0' && cur_char <= '9') {
            number = number * 10 + (cur_char - '0');
        } else {
            if (cur_char == 's') {
                number = number * 1000;
            } else if (cur_char == 'm') {
                number = number * 60000;
            }
            break;
        }
    }
    FURI_LOG_I("GMH", "number: %d", number);
    return number;
}